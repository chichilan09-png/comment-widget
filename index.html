<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
body{font-family:Arial}
.comment-box{border:1px solid #ddd;padding:10px;margin:10px;border-radius:10px}
.comment-box img{border-radius:50%;vertical-align:middle}
.comment-box b{margin-left:10px}
</style>
</head>

<body>

<h3>ðŸ’¬ BÃ¬nh luáº­n</h3>
<div id="comments"></div>

<form id="commentForm">
<input id="name" placeholder="TÃªn cá»§a báº¡n" required><br><br>
<textarea id="comment" placeholder="Viáº¿t bÃ¬nh luáº­n..." required></textarea><br><br>
<button type="submit">Gá»­i</button>
</form>

<script>
const API="https://script.google.com/macros/s/AKfycby_Q9yLCR4JLxYjn1vEYBeQJd6dWYv2xtg_dAKtkTV0YUo92DPxCxzH37Nk5k32Gxno/exec";


const PAGE = window.location.href; 

const avatars=[
 "https://raw.githubusercontent.com/chichilan09-png/comment-widget/main/Avatars/avatar1.jpg",
 "https://raw.githubusercontent.com/chichilan09-png/comment-widget/main/Avatars/avatar2.jpg",
 "https://raw.githubusercontent.com/chichilan09-png/comment-widget/main/Avatars/avatar3.jpg",
 "https://raw.githubusercontent.com/chichilan09-png/comment-widget/main/Avatars/avatar4.jpg",
 "https://raw.githubusercontent.com/chichilan09-png/comment-widget/main/Avatars/avatar5.jpg",
 "https://raw.githubusercontent.com/chichilan09-png/comment-widget/main/Avatars/avatar6.jpg",
 "https://raw.githubusercontent.com/chichilan09-png/comment-widget/main/Avatars/avatar7.jpg",
 "https://raw.githubusercontent.com/chichilan09-png/comment-widget/main/Avatars/avatar8.jpg",
 "https://raw.githubusercontent.com/chichilan09-png/comment-widget/main/Avatars/avatar9.jpg",
 "https://raw.githubusercontent.com/chichilan09-png/comment-widget/main/Avatars/avatar10.jpg",
 "https://raw.githubusercontent.com/chichilan09-png/comment-widget/main/Avatars/avatar11.jpg",
 "https://raw.githubusercontent.com/chichilan09-png/comment-widget/main/Avatars/avatar12.jpg",
 "https://raw.githubusercontent.com/chichilan09-png/comment-widget/main/Avatars/avatar13.jpg",
 "https://raw.githubusercontent.com/chichilan09-png/comment-widget/main/Avatars/avatar14.jpg",
 "https://raw.githubusercontent.com/chichilan09-png/comment-widget/main/Avatars/avatar15.jpg"
];

function randomAvatar(){
 return avatars[Math.floor(Math.random()*avatars.length)];
}


async function loadComments(){
 try{
  const res = await fetch(API+"?page="+encodeURIComponent(PAGE));
  const data = await res.json();
  render(data);
 }catch(e){
  console.log("Load error:", e);
 }
}


function render(data){
 const box = document.getElementById("comments");
 box.innerHTML="";
 data.forEach(c=>{
  box.innerHTML += `
   <div class="comment-box">
    <img src="${c.avatar}" width="40">
    <b>${c.name}</b><br>
    <div>${c.comment}</div>
   </div>
  `;
 });
}


document.getElementById("commentForm").addEventListener("submit", async function(e){
 e.preventDefault();

 const name = document.getElementById("name").value;
 const comment = document.getElementById("comment").value;

 await fetch(API,{
  method:"POST",
  headers: {"Content-Type":"application/json"},
  body: JSON.stringify({
   page: PAGE,
   name: name,
   avatar: randomAvatar(),
   comment: comment
  })
 });

 document.getElementById("name").value="";
 document.getElementById("comment").value="";
 loadComments();
});

// refresh má»—i 3s (á»•n Ä‘á»‹nh hÆ¡n)
setInterval(loadComments,3000);
loadComments();
</script>

</body>
</html>
